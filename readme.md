<div align="center">
  <a href="https://storage.googleapis.com/cms-storage-bucket/0dbfcc7a59cd1cf16282.png">
    <picture>
      <img alt="ROS2" src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmZmZmIiByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+Uk9TPC90aXRsZT48cGF0aCBkPSJNMi44MDcgMEMxLjM1MyAwIC4xNzMgMS4yMi4xNzMgMi43MjJjMCAxLjUwNCAxLjE4IDIuNzIzIDIuNjM0IDIuNzIzIDEuNDU1IDAgMi42MzUtMS4yMiAyLjYzNS0yLjcyM1M0LjI2MiAwIDIuODA3IDB6TTEyIDBjLTEuNDU1IDAtMi42MzQgMS4yMi0yLjYzNCAyLjcyMiAwIDEuNTA0IDEuMTggMi43MjMgMi42MzQgMi43MjMgMS40NTUgMCAyLjYzNC0xLjIyIDIuNjM0LTIuNzIzUzEzLjQ1NCAwIDEyIDB6bTkuMTkzIDBjLTEuNDU1IDAtMi42MzUgMS4yMi0yLjYzNSAyLjcyMiAwIDEuNTA0IDEuMTggMi43MjMgMi42MzUgMi43MjMgMS40NTUgMCAyLjYzNC0xLjIyIDIuNjM0LTIuNzIzUzIyLjY0NyAwIDIxLjE5MyAwek0yLjgwNyA5LjI3N0MxLjM1MyA5LjI3Ny4xNzMgMTAuNDk3LjE3MyAxMnMxLjE4IDIuNzIyIDIuNjM0IDIuNzIyYzEuNDU1IDAgMi42MzUtMS4yMTkgMi42MzUtMi43MjIgMC0xLjUwNC0xLjE4LTIuNzIzLTIuNjM1LTIuNzIzem05LjE5MyAwYy0xLjQ1NSAwLTIuNjM0IDEuMjItMi42MzQgMi43MjNzMS4xOCAyLjcyMiAyLjYzNCAyLjcyMmMxLjQ1NSAwIDIuNjM0LTEuMjE5IDIuNjM0LTIuNzIyIDAtMS41MDQtMS4xOC0yLjcyMy0yLjYzNC0yLjcyM3ptOS4xOTMgMGMtMS40NTUgMC0yLjYzNSAxLjIyLTIuNjM1IDIuNzIzczEuMTggMi43MjIgMi42MzUgMi43MjJjMS40NTUgMCAyLjYzNC0xLjIxOSAyLjYzNC0yLjcyMiAwLTEuNTA0LTEuMTgtMi43MjMtMi42MzQtMi43MjN6TTIuODA3IDE4LjU1NWMtMS40NTQgMC0yLjYzNCAxLjIyLTIuNjM0IDIuNzIyQy4xNzMgMjIuNzgxIDEuMzUzIDI0IDIuODA3IDI0YzEuNDU1IDAgMi42MzUtMS4yMiAyLjYzNS0yLjcyM3MtMS4xOC0yLjcyMi0yLjYzNS0yLjcyMnptOS4xOTMgMGMtMS40NTUgMC0yLjYzNCAxLjIyLTIuNjM0IDIuNzIyQzkuMzY2IDIyLjc4MSAxMC41NDYgMjQgMTIgMjRjMS40NTUgMCAyLjYzNC0xLjIyIDIuNjM0LTIuNzIzcy0xLjE4LTIuNzIyLTIuNjM0LTIuNzIyem05LjE5MyAwYy0xLjQ1NSAwLTIuNjM1IDEuMjItMi42MzUgMi43MjIgMCAxLjUwNCAxLjE4IDIuNzIzIDIuNjM1IDIuNzIzIDEuNDU1IDAgMi42MzQtMS4yMiAyLjYzNC0yLjcyM3MtMS4xOC0yLjcyMi0yLjYzNC0yLjcyMnoiLz48L3N2Zz4=" height="128">
    </picture>
  </a>
  <h1 style="margin-top:12px;">Lictic 360</h1>

<a href="https://docs.ros.org/en/humble/index.html">
	<img alt="ROS2" src="https://img.shields.io/badge/ROS1-Noetic-88b55a?style=for-the-badge&logo=ros&logoColor=ffffff">
</a>
<a href="https://docs.ros.org/en/humble/index.html">
	<img alt="ROS2" src="https://img.shields.io/badge/ROS2-Humble-336c9a?style=for-the-badge&logo=ros&logoColor=ffffff">
</a>
<a href="https://docs.ros.org/en/humble/index.html">
	<img alt="YOLO" src="https://img.shields.io/badge/ResNet-18-50b730?style=for-the-badge&logo=nvidia&logoColor=ffffff">
</a>
<a href="https://docs.ros.org/en/humble/index.html">
	<img alt="YOLO" src="https://img.shields.io/badge/YOLO-V11-0f81c2?style=for-the-badge&logo=yolo&logoColor=ffffff">
</a>
</div>
(LiDAR and Camera Semantic 360) - A ROS2 project that aims to develop a semantic mapping system using a 360-degree camera array, integrated with 2D LiDAR. The system will convert panoramic images captured by the cameras into 2D maps that generated by using GMapping. The semantic map classify various elements of the environment. By using semantic mapping techniques, autonomous vehicles or robots will be better able to understand and navigate their surroundings by providing richer context about the objects and areas around them.

## Developer Notes
This repository focused on applying semantic mapping for Husky Clearpath A200 while also working with Jetson AGX Orin. However, it's still possible to use this repo as reference to working on Semantic Mapping. The difference would only appear on how to implement the structure of the project.

## Project Structure
```
.
├──src
│  ├── gmapper
│  ├── merger
│  ├── ros_deep_learning
│  ├── segnet
│  ├── yolosed
│  └── visual
│
└──support
   ├── openslam_gmapping
   └── relay
```

## How To Build
### Prerequisite
- ROS2 Humble at Jetson Orin
- ROS1 Noetic at Husky Clearpath A200
- ROS Bridge for Humble [(GitHub: TommyChangUMD)](https://github.com/TommyChangUMD/ros-humble-ros1-bridge-builder)
- YOLO by Ultralytics or Jetson Inference
- Velodyne LiDAR [(yavuzertugrul)](https://yavuzertugrul.com/Lidar_part_1#velodyne-vlp-16-lidar-ros2-humble-test-on-nvidia-jetson-orin-nx-8-gb-jetpack) or another 2D LiDAR
- CMake9 or higher
### Installation
Assuming we already installed the prerequisites and understood the basics of ROS, we can continue on these steps. 
1. Clone this [Repository](https://github.com/Robotic-System-Lab/Lintic-360.git) into your ROS2 workspace.
```bash
mkdir -p ~/lintic_ws && cd ~/lintic_ws
git clone https://github.com/Robotic-System-Lab/Lintic-360.git .
```
2. We're using 2 main devices (Husky and Jetson), so we need to create a connection between them. In this case, I already set-up the connection by using a Ethernet Cable. We need to do some basic preparations in this case.
```bash
# Husky Clearpath A200 at `~/.bashrc`
export ROS_MASTER_URI=http://192.168.131.1:11311
export ROS_IP=192.168.131.1

# Jetson Orin at `~/.bashrc`
export ROS_MASTER_URI=http://192.168.1.100:11311
export ROS_IP=192.168.1.103
```
3. Using raw published topics will not work since Husky has a complex network settings. Create this file and run `rosparam load bridge.yaml` to setup for `/odom` topic bridge.
```yaml
# Husky Clearpath A200 at `bridge.yaml`
topics:
  -
    topic: /odom
    type: nav_msgs/msg/Odometry
    queue_size: 10
```
4. In the Husky, we will need to create a package to run `relay` node. This node will run in ROS1. Make sure to modify the CMakeList.txt and put the `executable` and `target_link_libraries`.
```bash
# ROS1
mkdir -p ~/relay_ws/src && cd ~/relay_ws/src
catkin_create_pkg relay roscpp nav_msgs tf2_ros geometry_msgs
```
5. Run the node and the `rostopic list` should include new topic called `/odom` beside the `/odometry/odometry_filtered`
```bash
# ROS1
rosrun relay odom
```
6. Since we're using two different devices, we need to register the Husky as a host in the Jetson. Run sudo nano `/etc/hosts` and add this line (sometimes, we also need to restart the Jetson to apply this change)
```bash
# Husky's IP should be like this according to the Official Documentation 
192.168.131.1 husky
```
7. The setups are done, we can navigate into `support/openslam_gmapping/` and we will install customized library that was originally made by [siddarth09](https://github.com/siddarth09/ros2_gmapping)
```bash
# ROS2
cd ~/lintic_ws/support/
mkdir build
cmake ..
sudo make install
```
8. Build the whole packages
> The `ros_deep_learning` package was meant to launch camera for Jetson. If u're not using it, create a `COLCON IGNORE` file inside of the packages.
> Since we will only use one object detection for a single run, you can choose to build `segnet` or `yolosed`. (The segnet will run with Jetson Inference while yolosed run with YOLO by Ultralytics)
```bash
# ROS2
cd ~/lintic_ws/
colcon build
source install/setup.bash
```

## How To Run
After all those setups, we can run those nodes and launch files:
> Ignore the ros_deep_learning if u're not using it
```bash
ros2 launch ros_deep_learning video_source.ros2v2.launch
```
> You can change this if you're using another version or brand of LiDAR sensor
```bash
ros2 launch velodyne velodyne-all-nodes-VLP32C-launch.py
```
> Initiate the ROS Bridge
```bash
ros2 run ros1_bridge parameter_bridge
```
> Run the broadcaster for /odom
```bash
ros2 run merger odom
```
> Run the main GMapping process
```bash
ros2 run gmapper semap
```
> Run `segnet` if u want to use Jetson Inference or `yolosed` if u want to use YOLO instead
```bash
ros2 run segnet denset
ros2 run yolosed seg
```

## Common Issues
1. `nlohmann` related error encountered frequently, make sure to check every single error occured on ur machine. Run this if you found one.
```bash
sudo apt-get -y install nlohmann-json3-dev
```